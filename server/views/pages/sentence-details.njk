{% extends "../partials/case.njk" %}
{% set pageTitle = applicationName + " - Sentence Details" %}
{% set currentNavSection = 'sentence-details' %}
{% set currentSectionName = 'Sentence' %}
{% set headerPersonName = sentenceDetails.name.forename + ' ' + sentenceDetails.name.surname %}
{% set headerCRN = crn %}

{% block beforeContent %}
    {{ govukBreadcrumbs({
      items: [
        {
          text: "Your cases",
          href: "/search"
        },
        {
          text: headerPersonName,
          href: "/case/" + crn
        },
        {
          text: currentSectionName
        }
      ]
    }) }}
{% endblock %}

{% block pageContent %}
    {% for sentence in sentenceDetails.sentences %}
         {% set hasAdditionalOffences = sentence.offence.additionalOffences and sentence.offence.additionalOffences.length > 0 %}
            {% set additionalOffences %}
              {% if hasAdditionalOffences %}
              <ol class="govuk-list{% if case.currentOrder.additionalOffences.length > 1 %} govuk-list--number{% endif %}">
                {% for additionalOffence in case.currentOrder.additionalOffences %}
                  <li>{{ additionalOffence.subCategoryDescription }} (1 count)</li>
                {% endfor %}
              </ol>

              <a href="/cases/{{ crn }}/sentence/offences">View additional offence details</a>
              {% endif %}
         {% endset %}

        {% set offence %}
          {{ govukSummaryList({
            rows: [
              {
                key: { text: "Main offence" },
                value: { html: sentence.offence.offence.description + ' (' + sentence.offence.offence.count + ' count)' }
              },
              {
                key: { text: "Offence date" },
                value: { text: sentence.offence.dateOfOffence | dateWithYear }
              },
              {
                key: { text: "Notes" },
                value: { html: sentence.offence.notes | nl2br if sentence.offence.notes else 'No notes' }
              },
              {
                key: { text: "Additional offences" },
                value: { html: additionalOffences if hasAdditionalOffences else 'No additional offences' }
              }
            ]
          }) }}
        {% endset %}

        {{ appSummaryCard({
          titleText: 'Offence',
          classes: 'govuk-!-margin-bottom-6 app-summary-card--large-title',
          html: offence
        }) }}

    {%- endfor %}
{% endblock %}



